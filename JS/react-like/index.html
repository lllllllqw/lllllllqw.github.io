<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <div id="app">

  </div>
  <script>
    ! function (root) {
      // class Add {
      //   constructor() {
      //     this.state = {
      //       number: 0
      //     }
      //   }

      //   setState(newState) {
      //     const oldElment = this.wrapper
      //     this.state = { ...newState
      //     }
      //     this.wrapper = this.render()

      //     if (this.update) {
      //       this.update(oldElment, this.wrapper)
      //     }
      //   }

      //   createWrapper(str) {
      //     const wrapper = document.createElement('div')
      //     wrapper.innerHTML = str
      //     return wrapper
      //   }

      //   onClick() {
      //     let number = this.state.number + 1
      //     this.setState({
      //       number
      //     })
      //   }

      //   render() {
      //     const domStr =
      //       `
      //     <p class="text">${this.state.number}</p>
      //     <p class="text">${this.state.number}</p>
      //     <p class="text">${this.state.number}</p>
      //     <div>
      //       <button class="add-btn">+</button>
      //     </div>
      //     `
      //     this.wrapper = this.createWrapper(domStr)
      //     if (this.onClick) {
      //       let addButton = this.wrapper.querySelector('.add-btn')
      //       addButton.addEventListener('click', this.onClick.bind(this))
      //     }
      //     return this.wrapper
      //   }
      // }

      class ButtonComponent {
        setState(newState) {
          const oldElment = this.wrapper
          this.state = { 
            ...newState
          }
          this.wrapper = this.renderElement()

          console.log(1)
          if (this.update) {
            this.update(oldElment, this.wrapper)
          }
        }

        createWrapper(str) {
          const wrapper = document.createElement('div')
          wrapper.innerHTML = str
          return wrapper
        }

        renderElement() {
          this.wrapper = this.createWrapper(this.render())
          if (this.onClick) {
            let addButton = this.wrapper.querySelector('.add-btn')
            addButton.addEventListener('click', this.onClick.bind(this))
          }
          return this.wrapper
        }
      }

      class Add extends ButtonComponent {
        constructor() {
          super()
          this.state = {
            number: 0
          }
        }

        onClick() {
          let number = this.state.number + 1
          this.setState({
            number
          })
        }

        render() {
          return `
          <p class="text">${this.state.number}</p>
          <p class="text">${this.state.number}</p>
          <p class="text">${this.state.number}</p>
          <div>
            <button class="add-btn">+</button>
          </div>
          `
        }
      }

      function renderToDom(component, element) {
        component.update = (old, next) => {
          element.insertBefore(next, old)
          element.removeChild(old)
        }
        element.appendChild(component.renderElement())
      }

      let app = document.querySelector('#app')
      let add = new Add()

      renderToDom(add, app)

    }(window)
  </script>
</body>

</html>